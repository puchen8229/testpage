[file name]: vocal-ai-assistant-complete-fixed.html
[file content begin]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocal Calculus Assistant - Complete Fixed Version</title>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #2563eb;
            --accent-color: #dc2626;
            --stop-color: #ef4444;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --text-color: #1f2937;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 25px;
        }
        
        .voice-controls {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .voice-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: var(--primary-color);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stop-btn {
            background: var(--stop-color);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .voice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(1);
        }
        
        .voice-btn.listening {
            background: var(--accent-color);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
            animation: pulse 1.5s infinite;
        }
        
        .stop-btn.active {
            background: #b91c1c;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(185, 28, 28, 0.4);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1.1); }
        }
        
        .voice-status {
            margin-top: 15px;
            font-size: 16px;
            color: var(--text-color);
            min-height: 24px;
        }
        
        .permission-guide {
            background: #fffbeb;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--warning-color);
            margin: 15px 0;
            text-align: left;
        }
        
        .permission-guide h3 {
            color: #b45309;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .permission-steps {
            padding-left: 20px;
        }
        
        .permission-steps li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .conversation {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: var(--primary-color);
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message {
            background: #e5e7eb;
            color: var(--text-color);
            margin-right: auto;
        }
        
        .error-message {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fecaca;
            margin-right: auto;
        }
        
        .ai-message.speaking {
            background: #dbeafe;
            border: 2px solid var(--primary-color);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-group {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .control-group h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: var(--primary-color);
        }
        
        select, button.control-btn {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        button.control-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button.control-btn:hover {
            background: var(--secondary-color);
        }
        
        .test-panel {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #0ea5e9;
            margin-top: 25px;
        }
        
        .test-panel h3 {
            color: #0369a1;
            margin-top: 0;
        }
        
        .test-text {
            line-height: 1.8;
            font-size: 16px;
            user-select: text;
            cursor: text;
        }
        
        .voice-command-guide {
            background: #ecfdf5;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--success-color);
            margin-top: 15px;
        }
        
        .voice-command-guide h4 {
            color: #047857;
            margin: 0 0 10px 0;
        }
        
        .command-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        
        .command-item {
            padding: 8px;
            background: #d1fae5;
            border-radius: 6px;
            border-left: 4px solid var(--success-color);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 600px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .voice-btn {
                width: 70px;
                height: 70px;
            }
            
            .voice-buttons {
                gap: 10px;
            }
            
            .command-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé§ Complete Fixed Vocal Assistant</h1>
            <p>Text selection bug fixed ‚Ä¢ Proper concept recognition</p>
        </div>
        
        <div class="main-content">
            <div class="voice-controls">
                <div class="voice-buttons">
                    <button class="voice-btn" id="voiceButton">üé§</button>
                    <button class="voice-btn stop-btn" id="stopButton" disabled>‚èπÔ∏è</button>
                </div>
                <div class="voice-status" id="voiceStatus">Click microphone to ask a question</div>
            </div>

            <div class="permission-guide" id="permissionGuide">
                <h3>üîí Microphone Permission Required</h3>
                <p>To use voice features, please allow microphone access:</p>
                <ol class="permission-steps">
                    <li><strong>Click the microphone button</strong> above</li>
                    <li>When the browser asks for permission, click <strong>"Allow"</strong></li>
                    <li>If you accidentally clicked "Block", refresh the page and try again</li>
                    <li>Make sure you're using <strong>Chrome, Edge, or Safari</strong></li>
                </ol>
            </div>
            
            <div class="conversation" id="conversation">
                <div class="message ai-message">
                    Welcome! Text selection bug is now fixed! <br><br>
                    <strong>Try selecting:</strong> "derivative", "integral", "limit", "function", or "variable"<br>
                    <strong>Or ask:</strong> "What is a derivative?" or "Explain integrals to me"
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <h3>üéµ Voice Personality</h3>
                    <select id="voicePersonality">
                        <option value="natural">Natural & Clear</option>
                        <option value="friendly">Friendly & Warm</option>
                        <option value="professional">Professional & Precise</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <h3>‚ö° Voice Settings</h3>
                    <select id="voiceSpeed">
                        <option value="0.9">Slow & Clear</option>
                        <option value="1.0" selected>Normal Pace</option>
                        <option value="1.1">Conversational</option>
                    </select>
                    <button class="control-btn" id="testVoiceBtn">Test Voice Output</button>
                </div>
            </div>
            
            <div class="voice-command-guide">
                <h4>üéØ Try These Voice Commands:</h4>
                <div class="command-list">
                    <div class="command-item">"What is a derivative?"</div>
                    <div class="command-item">"Explain integrals to me"</div>
                    <div class="command-item">"Tell me about limits"</div>
                    <div class="command-item">"What are functions?"</div>
                    <div class="command-item">"Stop" or "Enough"</div>
                </div>
            </div>
            
            <div class="test-panel">
                <h3>üìù Practice Text - Select Concepts to Explore:</h3>
                <div class="test-text" id="testText">
                    In calculus, the derivative measures how a function changes as its input changes. 
                    It represents the instantaneous rate of change. The integral is essentially the 
                    reverse operation of the derivative and represents accumulation. Limits help us 
                    understand function behavior near specific points. Linear functions have constant 
                    rates of change, while exponential functions grow at rates proportional to their 
                    current value. Variables are symbols that represent mathematical objects, and 
                    composite functions combine multiple functions together.
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Text Selection Bug Fixed ‚Ä¢ Proper Concept Recognition ‚Ä¢ Chrome/Edge Recommended</p>
        </div>
    </div>

    <script>
        class FixedSelectionAssistant {
            constructor() {
                this.isListening = false;
                this.isSpeaking = false;
                this.currentUtterance = null;
                this.recognition = null;
                this.microphoneAccess = false;
                this.initializeElements();
                this.setupEventListeners();
                this.checkBrowserSupport();
                this.setupTextSelection();
            }
            
            initializeElements() {
                this.voiceButton = document.getElementById('voiceButton');
                this.stopButton = document.getElementById('stopButton');
                this.voiceStatus = document.getElementById('voiceStatus');
                this.conversationElement = document.getElementById('conversation');
                this.voicePersonality = document.getElementById('voicePersonality');
                this.voiceSpeed = document.getElementById('voiceSpeed');
                this.testVoiceBtn = document.getElementById('testVoiceBtn');
                this.testText = document.getElementById('testText');
                this.permissionGuide = document.getElementById('permissionGuide');
                this.lastAiMessage = null;
                this.lastSelection = '';
                this.selectionTimeout = null;
            }
            
            setupTextSelection() {
                this.testText.addEventListener('mouseup', () => {
                    this.handleTextSelection();
                });
                
                document.addEventListener('selectionchange', () => {
                    this.handleTextSelection();
                });
            }
            
            handleTextSelection() {
                clearTimeout(this.selectionTimeout);
                
                this.selectionTimeout = setTimeout(() => {
                    const selection = window.getSelection().toString().trim();
                    
                    if (selection && selection !== this.lastSelection && 
                        selection.length > 2 && selection.length < 100) {
                        this.lastSelection = selection;
                        this.explainSelectedText(selection);
                    }
                }, 500);
            }
            
            checkBrowserSupport() {
                const hasSpeechRecognition = 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;
                const hasSpeechSynthesis = 'speechSynthesis' in window;
                
                if (!hasSpeechRecognition) {
                    this.showMessage('error', '‚ö†Ô∏è Voice input not supported. Please use Chrome, Edge, or Safari.');
                    this.voiceButton.disabled = true;
                    this.permissionGuide.innerHTML = `
                        <h3>‚ùå Browser Not Supported</h3>
                        <p>Voice input requires Chrome, Edge, or Safari. Please switch browsers.</p>
                    `;
                }
                
                if (!hasSpeechSynthesis) {
                    this.showMessage('error', '‚ö†Ô∏è Voice output not supported in this browser.');
                }
            }
            
            setupEventListeners() {
                this.voiceButton.addEventListener('click', () => this.toggleListening());
                this.stopButton.addEventListener('click', () => this.stopSpeaking());
                this.testVoiceBtn.addEventListener('click', () => this.testVoice());
            }
            
            async toggleListening() {
                if (this.isSpeaking) {
                    this.stopSpeaking();
                    return;
                }
                
                if (!this.recognition) {
                    await this.initializeSpeechRecognition();
                }
                
                if (this.isListening) {
                    this.stopListening();
                } else {
                    await this.startListening();
                }
            }
            
            async initializeSpeechRecognition() {
                try {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.voiceButton.classList.add('listening');
                        this.voiceStatus.textContent = 'üé§ Listening... Ask your question';
                        this.showMessage('ai', 'I\'m listening... Please ask your question.');
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceCommand(transcript);
                    };
                    
                    this.recognition.onend = () => {
                        this.stopListening();
                    };
                    
                    this.recognition.onerror = (event) => {
                        this.handleRecognitionError(event.error);
                    };
                    
                } catch (error) {
                    this.showMessage('error', `Failed to initialize speech recognition: ${error.message}`);
                }
            }
            
            async startListening() {
                try {
                    const permission = await navigator.permissions.query({ name: 'microphone' });
                    
                    if (permission.state === 'denied') {
                        this.showMessage('error', '‚ùå Microphone access was denied. Please refresh the page and allow access.');
                        return;
                    }
                    
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop());
                    
                    this.microphoneAccess = true;
                    this.permissionGuide.style.display = 'none';
                    this.recognition.start();
                    
                } catch (error) {
                    this.handleMicrophoneError(error);
                }
            }
            
            handleMicrophoneError(error) {
                switch (error.name) {
                    case 'NotAllowedError':
                        this.showMessage('error', '‚ùå Microphone access denied. Please refresh and click "Allow".');
                        break;
                    case 'NotFoundError':
                        this.showMessage('error', '‚ùå No microphone found. Please connect a microphone.');
                        break;
                    case 'NotReadableError':
                        this.showMessage('error', '‚ùå Microphone is in use by another application.');
                        break;
                    default:
                        this.showMessage('error', `‚ùå Microphone error: ${error.message}`);
                }
            }
            
            handleRecognitionError(error) {
                switch (error) {
                    case 'not-allowed':
                        this.showMessage('error', '‚ùå Microphone access not allowed. Please allow access.');
                        break;
                    case 'no-speech':
                        this.showMessage('ai', 'I didn\'t hear anything. Please try again.');
                        break;
                    case 'audio-capture':
                        this.showMessage('error', '‚ùå No microphone detected.');
                        break;
                    default:
                        this.showMessage('error', `‚ùå Recognition error: ${error}`);
                }
                
                this.stopListening();
            }
            
            stopListening() {
                this.isListening = false;
                this.voiceButton.classList.remove('listening');
                this.voiceStatus.textContent = 'Click microphone to ask a question';
                
                if (this.recognition) {
                    this.recognition.stop();
                }
            }
            
            stopSpeaking() {
                if (this.isSpeaking && window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                    this.handleSpeechEnd();
                    this.showMessage('ai', 'Voice stopped.');
                }
            }
            
            handleSpeechStart() {
                this.isSpeaking = true;
                this.stopButton.disabled = false;
                this.stopButton.classList.add('active');
                this.voiceStatus.textContent = 'Speaking... Say "stop" to interrupt';
                
                if (this.lastAiMessage) {
                    this.lastAiMessage.classList.add('speaking');
                }
            }
            
            handleSpeechEnd() {
                this.isSpeaking = false;
                this.stopButton.disabled = true;
                this.stopButton.classList.remove('active');
                this.voiceStatus.textContent = 'Click microphone to ask a question';
                
                if (this.lastAiMessage) {
                    this.lastAiMessage.classList.remove('speaking');
                }
            }
            
            processVoiceCommand(transcript) {
                this.showMessage('user', transcript);
                
                const lowerTranscript = transcript.toLowerCase();
                const stopCommands = ['stop', 'quiet', 'shut up', 'enough', 'listen to me', 'wait', 'pause'];
                
                if (stopCommands.some(cmd => lowerTranscript.includes(cmd))) {
                    this.stopSpeaking();
                    if (lowerTranscript.includes('listen to me')) {
                        setTimeout(() => this.startListening(), 1000);
                    }
                    return;
                }
                
                const response = this.understandAndRespond(transcript);
                
                setTimeout(() => {
                    this.showMessage('ai', response);
                    this.speakResponse(response);
                }, 1000);
            }
            
            understandAndRespond(inputText) {
                const lowerText = inputText.toLowerCase();
                
                // FIXED: Enhanced concept detection for text selection
                const conceptMap = {
                    'derivative': this.getDerivativeExplanation(),
                    'integral': this.getIntegralExplanation(),
                    'limit': this.getLimitExplanation(),
                    'function': this.getFunctionExplanation(),
                    'variable': this.getVariableExplanation(),
                    'composite': this.getCompositeExplanation(),
                    'exponential': this.getExponentialExplanation(),
                    'linear': this.getLinearExplanation(),
                    'change': this.getDerivativeExplanation(),
                    'rate': this.getDerivativeExplanation(),
                    'accumulation': this.getIntegralExplanation(),
                    'area': this.getIntegralExplanation(),
                    'behavior': this.getLimitExplanation(),
                    'input': this.getFunctionExplanation(),
                    'output': this.getFunctionExplanation(),
                    'symbol': this.getVariableExplanation(),
                    'placeholder': this.getVariableExplanation(),
                    'combine': this.getCompositeExplanation(),
                    'growth': this.getExponentialExplanation(),
                    'constant': this.getLinearExplanation()
                };
                
                // FIXED: Check for specific concepts in selected text
                for (const [concept, explanation] of Object.entries(conceptMap)) {
                    const regex = new RegExp(`\\b${concept}\\b`, 'i');
                    if (regex.test(lowerText)) {
                        return explanation;
                    }
                }
                
                // FIXED: Handle voice questions
                if (lowerText.includes('what is') || lowerText.includes('explain') || 
                    lowerText.includes('tell me about') || lowerText.includes('define')) {
                    
                    const questionPatterns = [
                        { pattern: /(what is|explain|tell me about|define).*derivative/, response: this.getDerivativeExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*integral/, response: this.getIntegralExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*limit/, response: this.getLimitExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*function/, response: this.getFunctionExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*variable/, response: this.getVariableExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*composite/, response: this.getCompositeExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*exponential/, response: this.getExponentialExplanation() },
                        { pattern: /(what is|explain|tell me about|define).*linear/, response: this.getLinearExplanation() }
                    ];
                    
                    for (const { pattern, response } of questionPatterns) {
                        if (pattern.test(lowerText)) {
                            return response;
                        }
                    }
                }
                
                if (/(hello|hi|hey|greetings)/i.test(lowerText)) {
                    return "Hello! I'm your calculus assistant. Ask me about derivatives, integrals, limits, or functions!";
                }
                
                if (/(thank|thanks|appreciate)/i.test(lowerText)) {
                    return "You're welcome! I'm happy to help with calculus questions.";
                }
                
                if (lowerText.length < 5) {
                    return "I'd be happy to explain that concept! Could you select more text or ask specifically?";
                }
                
                return `I'd be happy to explain "${inputText}"! This seems related to calculus. Try asking "What is ${inputText}?" or "Explain ${inputText} to me."`;
            }
            
            getDerivativeExplanation() {
                return "The derivative measures how a function changes as its input changes. It represents the instantaneous rate of change. Think of it like a speedometer for functions - it tells you exactly how fast something is changing at any given moment. For example, if you have a position function, its derivative gives you velocity!";
            }
            
            getIntegralExplanation() {
                return "The integral is the reverse operation of the derivative. It represents accumulation - adding up tiny pieces to find the total. While derivatives measure rates of change, integrals measure totals and areas. Think of it as sophisticated addition that can handle continuously changing quantities!";
            }
            
            getLimitExplanation() {
                return "Limits help us understand what happens as we approach a point, without necessarily reaching it. They're fundamental to calculus because they let us define derivatives and integrals precisely. Limits handle tricky situations like division by zero or infinite processes in a mathematically rigorous way.";
            }
            
            getFunctionExplanation() {
                return "A function is a special relationship where each input has exactly one output. Think of it like a machine: you put something in (the input), and you get something predictable out (the output). In your coffee shop example, revenue is a function of cups sold: R(Q) = 3.50Q. Every number of cups gives exactly one revenue amount.";
            }
            
            getVariableExplanation() {
                return "A variable is a symbol that represents a value that can change. It's like a placeholder or a container for values. In mathematics, variables allow us to write general rules and formulas that work for many different values. For example, in the equation y = 2x + 3, both x and y are variables.";
            }
            
            getCompositeExplanation() {
                return "A composite function combines two or more functions. It's like putting one function inside another. For example, if f(x) = x¬≤ and g(x) = x + 1, then the composite function f(g(x)) means you first add 1, then square the result: (x + 1)¬≤. This creates more complex relationships from simpler building blocks.";
            }
            
            getExponentialExplanation() {
                return "Exponential functions have the form f(x) = aÀ£, where the variable is in the exponent. They model rapid growth or decay, like population growth, radioactive decay, or compound interest. These functions change at rates proportional to their current value, which makes them grow incredibly fast!";
            }
            
            getLinearExplanation() {
                return "Linear functions have a constant rate of change. They create straight lines when graphed and have the general form y = mx + b, where m is the slope (rate of change) and b is the y-intercept. These are the simplest type of functions in calculus and have predictable, steady behavior.";
            }
            
            explainSelectedText(selectedText) {
                this.showMessage('user', `Explain: "${selectedText}"`);
                const response = this.understandAndRespond(selectedText);
                this.showMessage('ai', response);
                this.speakResponse(response);
            }
            
            showMessage(type, text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}-message`;
                messageDiv.textContent = text;
                
                this.conversationElement.appendChild(messageDiv);
                this.conversationElement.scrollTop = this.conversationElement.scrollHeight;
                
                const messages = this.conversationElement.querySelectorAll('.message');
                if (messages.length > 10) {
                    messages[0].remove();
                }
                
                if (type === 'ai') {
                    this.lastAiMessage = messageDiv;
                }
            }
            
            speakResponse(text) {
                if (!('speechSynthesis' in window)) return;
                
                this.stopSpeaking();
                
                this.currentUtterance = new SpeechSynthesisUtterance(text);
                
                const personality = this.voicePersonality.value;
                const speed = parseFloat(this.voiceSpeed.value);
                
                this.currentUtterance.rate = speed;
                this.currentUtterance.volume = 0.9;
                
                switch (personality) {
                    case 'natural':
                        this.currentUtterance.pitch = 1.0;
                        this.currentUtterance.rate = speed * 0.95;
                        break;
                    case 'friendly':
                        this.currentUtterance.pitch = 1.1;
                        this.currentUtterance.rate = speed * 0.9;
                        break;
                    case 'professional':
                        this.currentUtterance.pitch = 0.9;
                        this.currentUtterance.rate = speed * 1.0;
                        break;
                }
                
                this.currentUtterance.onstart = () => this.handleSpeechStart();
                this.currentUtterance.onend = () => this.handleSpeechEnd();
                this.currentUtterance.onerror = () => this.handleSpeechEnd();
                
                window.speechSynthesis.speak(this.currentUtterance);
            }
            
            testVoice() {
                const testText = "This is a voice test. If you can hear this, voice output is working properly.";
                this.speakResponse(testText);
                this.showMessage('ai', "Testing voice output... Adjust settings if needed.");
            }
        }
        
        // Initialize the fixed assistant
        document.addEventListener('DOMContentLoaded', () => {
            window.vocalAssistant = new FixedSelectionAssistant();
        });
    </script>
</body>
</html>
[file content end]